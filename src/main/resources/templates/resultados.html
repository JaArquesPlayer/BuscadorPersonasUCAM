<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta http-equiv="x-ua-compatible" content="ie=edge"/>
    <link rel="shortcut icon" th:href="@{/assets/img/escudo-ucam.svg}"  type="image/x-icon"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Buscador de personas UCAM</title>

    <link rel="stylesheet" th:href="@{/assets/plugins/ucam-icons/styles.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/swiper.min.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/main.styles.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/swiper.min.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/styles.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/resultado-busqueda.component.css}"/>
</head>

<body>
<header>
    <nav class="navbar navbar-light justify-content-between">
        <a class="navbar-brand mr-auto" th:href="@{/personas}">
            <img class="img-fluid" th:src="@{/assets/img/logo.svg?0102}" width="200" height="50" alt="Logo UCAM Personas">
        </a>

        <!-- login
        <div class="dropdown">
          <a class="decoration-none" href="#" id="loginButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="icon-button icon-perm-identity text-color-ucam-gray-medium"></span>
          </a>
          <div class="dropdown-menu dropdown-menu-right text-center p-3" aria-labelledby="loginButton">
            <span class="icon-button icon-button-xl text-size-subtitulo1 icon-perm-identity text-color-ucam-gray-medium"></span>
            <p class="dropdown-header">Iniciar sesión</p>
            <form id="loginForm" action="#">
              <button type="submit" class="btn btn-info">Iniciar sesión</button>
            </form>
          </div>
        </div>

        <div class="dropdown">
          <a class="decoration-none rounded-circle" href="#" id="loginButton2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <img src="data:image/png;base64," alt="Miguel Ángel Abenza" class="img-fluid" width="36">
          </a>
          <div class="dropdown-menu dropdown-menu-right text-center p-3" aria-labelledby="loginButton">

            <a href="#" title="Editar foto" class="edit-photo-link">
              <div class="photo-mask">
                <img src="data:image/png;base64," alt="Miguel Ángel Abenza" width="70">
              </div>
              <span class="edit-photo">
                <img th:src="@{assets/img/icon-camera.svg}" alt="Icono editar foto">
              </span>
            </a>

            <p class="dropdown-header"></p>
            <p>
              <small></small>
            </p>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="http://key.ucam.edu">
              <i class="icon-key"></i> Cambiar contraseña</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://inf.ucam.edu/personasucam/">
              <i class="icon-ajustes"></i> Modificar privacidad</a>
            <div class="dropdown-divider"></div>

            <button type="button" class="btn btn-info mt-3">Cerrar sesión</button>

          </div>
        </div>-->
    </nav>
</header>

<article>
    <div class="container mt-5">
        <!-- buscador -->
        <div class="row">
            <div class="col">
                <form id="busqueda-form">
                    <div class="input-group">
                        <span class="input-group-prepend">
                            <div class="input-group-text bg-ucam-gray-lighter border-right-0">
                                <i class="icon-lupa"></i>
                            </div>
                        </span>
                        <input id="busqueda" name="search" type="text" class="form-control bg-ucam-gray-lighter py-2 border-left-0" value="" placeholder="Nombre, apellidos, extensión, email, área de conocimiento..." th:value="${nombre}">
                    </div>
                </form>
            </div>
        </div>
        <!-- fin buscador -->

        <!-- mensaje resultados restringidos
        <div class="row mt-3">
            <div class="col">
                <div class="alert alert-light border alert-dismissible fade show d-flex" role="alert">
                    <i class="icon-artboard-1-copy-10-copia"></i>
                    <p class="m-0 ml-3">Se han encontrado más resultados en la búsqueda, pero por motivos de privacidad
                        solo estan visibles para miembros de la Universidad. Para poder visualizarlos,
                        <a><strong>inicie sesión</strong></a></p>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            </div>
        </div>
        fin mensaje -->

        <!-- resultados de búsqueda -->
        <div class="row">
            <div class="col">
                <!-- tabs -->
                <div id="swiper-results-tabs" class="swiper-container">
                    <ul class="nav nav-tabs nav-justified swiper-wrapper" id="results" role="tablist">

                        <li class="nav-item swiper-slide">
                            <a class="nav-link active" data-toggle="tab" role="tab" aria-controls="" aria-selected="true"
                               id="personal-tab" href="#personal">Personal UCAM</a>
                        </li>
                        <li class="nav-item swiper-slide">
                            <a class="nav-link" data-toggle="tab" role="tab" aria-controls="" aria-selected="false"
                               id="facultades-tab" href="#facultades">Facultades y Departamentos</a>
                        </li>
                        <li class="nav-item swiper-slide">
                            <a class="nav-link" data-toggle="tab" role="tab" aria-controls="" aria-selected="false"
                               id="publicaciones-tab" href="#publicaciones">Publicaciones</a>
                        </li>
                    </ul>
                </div>
                <!-- end tabs -->
            </div>
        </div>

        <!-- tabs content -->
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <!-- resultados -->
                <div class="tab-content" id="results-content">
                    <div class="tab-pane fade show active" id="personal" role="tabpanel" aria-labelledby="personal-tab">
                        <div id="resultados-personal" class="row"></div>
                    </div>
                    <!-- fin resultados -->

                    <!-- resultados -->
                    <div class="tab-pane fade" id="facultades" role="tabpanel" aria-labelledby="facultades-tab">
                        <div id="resultados-departamentos" class="row"></div>
                    </div>
                    <!-- fin resultados -->

                    <!-- resultados -->
                    <div class="tab-pane fade" id="publicaciones" role="tabpanel" aria-labelledby="publicaciones-tab">
                        <div id="resultados-publicaciones" class="row"></div>
                    </div>
                    <!-- end resultados -->
                </div>
                <!-- end tabs content -->
            </div>
        </div>
    </div>

    <!--Boton para volver arriba-->
    <button id="btn-up">
        <span id="btn-up-icon" class="material-symbols-outlined">expand_less</span>
    </button>
    <!--En of boton para volver arriba-->

</article>


<script th:src="@{/assets/js/vendor/jquery.slim.min.js}"></script>
<script th:src="@{/assets/js/vendor/bootstrap.min.js}"></script>
<script th:src="@{/assets/js/vendor/popper.min.js}"></script>
<script th:src="@{/assets/js/main.scripts.js}"></script>
<script th:src="@{/assets/js/vendor/swiper.js}"></script>
<script th:src="@{/assets/js/profile.scripts.js}"></script>

<!--Script para el boton de volver arriba-->
<script>
    window.onscroll = function () {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("btn-up").style.display = "block";
        } else {
            document.getElementById("btn-up").style.display = "none";
        }

        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("btn-up").style.display = "block";
        } else {
            document.getElementById("btn-up").style.display = "none";
        }
    };

    document.getElementById("btn-up").onclick = function () {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    };

    window.addEventListener('load', function() {
        setTimeout(function() {
            var input = document.getElementById('busqueda');
            var length = input.value.length;
            input.focus();
            input.setSelectionRange(length, length);
        }, 500);
    });
</script>

<!--Script para la busqueda en tiempo real del buscador-->
<script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    $(document).ready(function() {
        var timeout = null;
        var $busqueda = $('#busqueda');

        var contPersonas=0;
        var contDepartamentos=0;
        var contPublicaciones=0;

        var $url = "";
        var $url2 = "";
        var $url3 = "";

        if ($busqueda.val() == ""){
            $url = "/prueba/searchPersonal/" + "a";
            $url2 = "/prueba/searchDepartamentos/" + "a";
            $url3 = "/prueba/searchPublicaciones/" + "a";
        }else{
            $url = "/prueba/searchPersonal/" + $busqueda.val();
            $url2 = "/prueba/searchDepartamentos/" + $busqueda.val();
            $url3 = "/prueba/searchPublicaciones/" + $busqueda.val();
        }

        $.ajax({
            type: 'GET',
            url: $url,
            data: { page: contPersonas },
            dataType: 'html'
        })
        .done(function(data) {
            $('#resultados-personal').append(data);
            console.log('Personas encontrados correctamente');
        })
        .fail(function() {
            console.log('Error al buscar personas');
        });

        $.ajax({
            type: 'GET',
            url: $url2,
            data: { pagina: contDepartamentos },
            dataType: 'html'
        })
        .done(function(data) {
            $('#resultados-departamentos').append(data);
            console.log('Departamentos encontrados correctamente');
        })
        .fail(function() {
            console.log('Error al buscar departamentos');
        });

        $.ajax({
            type: 'GET',
            url: $url3,
            data: { pagina: contPublicaciones },
            dataType: 'html'
        })
        .done(function(data) {
            $('#resultados-publicaciones').append(data);
            console.log('Publicaciones encontradas correctamente');
        })
        .fail(function() {
            console.log('Error al buscar publicaciones');
        });

        $busqueda.on('keyup', function() {
            clearTimeout(timeout);
            timeout = setTimeout(function() {

                $('#busqueda-form').submit();

            }, 1000);
        });

        $(window).on('scroll', function() {
            if ($(document).height() - $(this).height() <= $(this).scrollTop()) {

                if($('#personal-tab').hasClass('active')){
                    if($('.cont_personas').last().val() != null){
                        contPersonas = $('.cont_personas').last().val();
                    }

                    $.ajax({
                        type: 'GET',
                        url: $url,
                        data: { page: contPersonas },
                        dataType: 'html'
                    })
                    .done(function (data) {
                        $('#resultados-personal').append(data);
                        console.log('Personas encontrados correctamente');
                    })
                    .fail(function () {
                        console.log('Error al buscar personas');
                    });
                }

                if($('#facultades-tab').hasClass('active')){
                    if($('.cont_departamentos').last().val() != null){
                        contDepartamentos = $('.cont_departamentos').last().val();
                    }

                    $.ajax({
                        type: 'GET',
                        url: $url2,
                        data: { pagina: contDepartamentos },
                        dataType: 'html'
                    })
                    .done(function(data) {
                        $('#resultados-departamentos').append(data);
                        console.log('Departamentos encontrados correctamente');
                    })
                    .fail(function() {
                        console.log('Error al buscar departamentos');
                    });
                }

                if($('#publicaciones-tab').hasClass('active')){
                    if($('.cont_publicaciones').last().val() != null){
                        contPublicaciones = $('.cont_publicaciones').last().val();
                    }

                    $.ajax({
                        type: 'GET',
                        url: $url3,
                        data: { pagina: contPublicaciones },
                        dataType: 'html'
                    })
                    .done(function(data) {
                        $('#resultados-publicaciones').append(data);
                        console.log('Publicaciones encontradas correctamente');
                    })
                    .fail(function() {
                        console.log('Error al buscar publicaciones');
                    });
                }
            }
        });
    });
</script>

</body>
</html>