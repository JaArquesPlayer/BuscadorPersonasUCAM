<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:fragment="head">
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta http-equiv="x-ua-compatible" content="ie=edge"/>
    <link rel="shortcut icon" th:href="@{/assets/img/escudo-ucam.svg}"  type="image/x-icon"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Buscador de personas UCAM</title>

    <link th:href="@{/assets/plugins/ucam-icons/styles.css}"  rel="stylesheet"/>
    <link th:href="@{/assets/css/main.css}" rel="stylesheet"/>
</head>

<body>
<header th:fragment="header">
    <nav class="navbar navbar-light bg-info justify-content-end">
        <a class="navbar-brand mr-auto" th:href="@{/personas}">
            <img class="img-fluid" src="/assets/img/logo.svg?0102" width="200" height="50" alt="Logo UCAM Personas">
        </a>
    </nav>
</header>

<article>
    <div class="container mt-5">
        <!-- buscador -->
        <div th:fragment="buscador" class="row">
            <div class="col">
                <form action="#">
                    <div class="input-group">
                        <span class="input-group-prepend">
                            <div class="input-group-text bg-ucam-gray-lighter border-right-0">
                                <i class="icon-lupa"></i>
                            </div>
                        </span>
                        <input id="busqueda2" type="text" th:value="${param.search}" class="form-control bg-ucam-gray-lighter py-2 border-left-0" name="search" placeholder="Nombre, apellidos, extensión, email...">
                    </div>
                </form>
            </div>
        </div>
        <!-- fin buscador -->

        <!-- resultados de búsqueda -->
        <div class="row">
            <div class="col">
                <!-- tabs -->
                <div th:fragment="tabs" id="swiper-results-tabs" class="swiper-container">
                    <ul class="nav nav-tabs nav-justified swiper-wrapper" id="results" role="tablist">

                        <li class="nav-item swiper-slide"><!-- todo th:if="${personal != null}" -->
                            <a class="nav-link active" data-toggle="tab" role="tab" aria-controls="" aria-selected="true"
                               id="personal-tab" href="#personal">Personal UCAM</a>
                        </li>
                        <li class="nav-item swiper-slide"><!-- todo th:if="${facultadesDepartamentos != null}" -->
                            <a class="nav-link" data-toggle="tab" role="tab" aria-controls="" aria-selected="false"
                               id="facultades-tab" href="#facultades">Facultades y Departamentos</a>
                        </li>
                        <li class="nav-item swiper-slide"><!-- todo th:if="${publicaciones}" -->
                            <a class="nav-link" data-toggle="tab" role="tab" aria-controls="" aria-selected="false"
                               id="publicaciones-tab" href="#publicaciones">Publicaciones</a>
                        </li>
                    </ul>
                </div>
                <!-- end tabs -->

                <!-- todo not found error -->
                <div th:fragment="notFoundError" th:if="${personal != null && facultadesDepartamentos == null && publicaciones == null}" class="col-12">
                    <p class="text-size-subtitulo1 text-color-info">Lo sentimos, no hemos encontrado ningún resultado para la búsqueda. </p>
                    <p>Te sugerimos que:</p>
                    <ul class="marker-secondary">
                        <li>Compruebes que las palabras que buscas están escritas correctmente</li>
                        <li>Intentes usar otras palabras</li>
                        <li>Pruebes con palabras más generales</li>
                    </ul>
                </div>
                <!-- end of not found error -->
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">

                <!-- tabs content -->
                <div th:fragment="tabsContent" class="tab-content" id="results-content">
                    <div class="tab-pane fade show active" id="personal" role="tabpanel" aria-labelledby="personal-tab">
                        <div id="resultados-personal" class="row"></div>
                    </div>

                    <!--Departamentos-->
                    <div class="tab-pane fade" id="facultades" role="tabpanel" aria-labelledby="facultades-tab">
                        <div id="related-profiles" class="row"></div>
                    </div>
                    <!--End of departamentos-->

                    <!--Publicaciones-->
                    <div class="tab-pane fade" id="publicaciones" role="tabpanel" aria-labelledby="publicaciones-tab">
                        <div id="resultados-publicaciones" class="row"></div>
                    </div>
                </div>
                <!--End of publicaciones-->
                <!-- end tabs content -->

                </div>
            </div>
        </div>
    </div>
    <!-- fin resultados de búsqueda -->

    </div>

    <!--Boton para volver arriba-->
    <button th:fragment="btn-up" id="btn-up">
        <span id="btn-up-icon" class="material-symbols-outlined">expand_less</span>
    </button>
    <!--En of boton para volver arriba-->

</article>

<script type="text/javascript" th:src="@{/assets/js/vendor/swiper.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/vendor/jquery.slim.min.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/vendor/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/vendor/popper.min.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/main.scripts.js}"></script>

<!--Script para el boton de volver arriba-->
<script>
    window.onscroll = function () {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("btn-up").style.display = "block";
        } else {
            document.getElementById("btn-up").style.display = "none";
        }
    };

    document.getElementById("btn-up").onclick = function () {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    };
</script>

<!--Script para la busqueda en tiempo real del buscador-->
<script src="//code.jquery.com/jquery-3.5.1.min.js"></script>

<!--Script para buscar personal-->
<script>
    $(document).ready(function() {
        var $busqueda = $('#busqueda2');
        var $resultadosPersonal = $('#resultados-personal');

        $busqueda.on('input', function() {

        $.getJSON('/searchPersonal', {nombre: $busqueda.val()})
            .done(function(personasEncontradas) {
                $resultadosPersonal.empty();

                personasEncontradas.forEach(function(persona) {
                    <!--todo añadir el enlace al departamento-->
                    var $card = $(
                        `    <div class="col-12 col-md-6">\n` +
                        `       <div class="card mb-3">\n`+
                        `               <div class="col-auto p-3">\n` +
                        `                   <img src="${persona.foto}" alt="${persona.nombre_mostrar}" width="86" height="105" class="img-fluid">\n` +
                        `               </div>\n` +
                        `               <div class="col">\n` +
                        `                   <div class="card-body d-flex flex-column justify-content-end h-100">\n` +
                        `                       <p class="card-title flex-1"><a href="/perfil/${persona.id}" title="${persona.nombre_mostrar}"> ${persona.nombre_mostrar}</a></p>\n` +
                        `                       <p th:if="${persona.correos_institucionales != null}" class="card-text"><i class="icon-email"></i> <a href="mailto:${persona.correos_institucionales[0]}" title="Enviar correo a ${persona.correos_institucionales[0]}">${persona.correos_institucionales[0]}</a></p>\n` +
                        `                       <p th:if="${persona.correos_personales != null}" class="card-text"><i class="icon-email"></i> <a href="mailto:${persona.correos_personales}" title="Enviar correo a ${persona.correos_personales}">${persona.correos_personales}</a></p>\n` +
                        `                       <p th:if="${persona.telefonos != null}" class="card-text"><i class="icon-phone"></i> <a href="tel:${persona.telefonos}" title="Llamar al teléfono ${persona.telefonos}">${persona.telefonos} ${persona.extension}</a></p>\n` +
                        `                       <p th:if="${persona.ubicacion != null}" class="card-text"><i class="icon-diploma"></i><a href="#">${persona.ubicacion}</a></p>\n` +
                        `                       <p th:if="${persona.instagram != null}" class="card-text"><i class="icon-instagram"></i><a href="${persona.instagram}" title="Instagram"></a></p>\n` +
                        `                       <p th:if="${persona.linkedin != null}" class="card-text"><i class="icon-linkedin"></i><a href="${persona.linkedin}" title="Linkedin"></a></p>\n` +
                        `                       <p th:if="${persona.twitter != null}" class="card-text"><i class="icon-twitter"></i><a href="${persona.twitter}" title="Twitter"></a></p>\n` +
                        `                   </div>\n` +
                        `               </div>\n` +
                        `           </div>\n` +
                        `       </div>\n` +
                        `   </div>\n`);

                    $resultadosPersonal.append($card);
                });
            })
            .fail(function() {
                console.log('Error al buscar personas');
            });
        });
    });
</script>

<!--Script para buscar departamentos-->
<!--
<script>
    $(document).ready(function() {
        var $busqueda = $('#busqueda2');
        var $resultadosDepartamentos = $('#related-profiles');

        $busqueda.on('input', function() {

        $.getJSON('/searchPersonal', {nombre: $busqueda.val()})
            .done(function(personasEncontradas) {
                $resultadosDepartamentos.empty();

                personasEncontradas.forEach(function(persona) {
                    var nombre = persona.nombre + ' ' + persona.apellidos;
                    var $card = $(
                        '<a href="/perfil/'+persona.id+'" title="'+nombre+'" class="related-profile__wrapper">\n' +
                        '   <div class="profile-card">\n' +
                        '       <img class="img-fluid" src="'+persona.image+'" alt="'+nombre+'">\n' +
                        '       <p class="related-profile__caption">'+nombre+'</p>\n' +
                        '   </div>\n' +
                        '</a>\n');

                    $resultadosDepartamentos.append($card);
                });
            })
            .fail(function() {
                console.log('Error al buscar personas');
            });
        });
    });
</script>
-->
<!--Script para buscar publicaciones-->
<!--
<script>
    $(document).ready(function() {
        var $busqueda = $('#busqueda2');
        var $resultadosPublicaciones = $('#resultados-publicaciones');

        $busqueda.on('input', function() {

        $.getJSON('/searchPublicaciones', { publicacion: $busqueda.val()})
            .done(function(publicacionesEncontradas) {
                $resultadosPublicaciones.empty();

                publicacionesEncontradas.forEach(function(publicacion) {
                    var $card = $(
                        '<div class="col-12">\n' +
                        '   <a href="#" class="text-color-info font-weight-bold mb-3">'+publicacion.titulo+'</a>\n' +
                        '       <p class="mt-3">'+publicacion.contenido+'</p>\n' +
                        '       <hr>\n' +
                        '</div>\n');

                    $resultadosPublicaciones.append($card);
                });
            })
            .fail(function() {
                console.log('Error al buscar personas');
            });
        });
    });
</script>
-->
</body>
</html>