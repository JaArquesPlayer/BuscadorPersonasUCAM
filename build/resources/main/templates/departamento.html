<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <link rel="shortcut icon" th:href="@{/assets/img/escudo-ucam.svg}"  type="image/x-icon"/>
    <title>Buscador de personas UCAM</title>

    <!-- Metadata
    <title th:text="${persona.nombre_mostrar} + ' | UCAM Universidad Católica de Murcia'"></title>

    <meta name="twitter:title" th:content="${persona.nombre_mostrar} + ' | UCAM Universidad Católica de Murcia'"/>
    <meta name="twitter:description" th:if="${cargos != null}" th:content="${persona.nombre_mostrar} + ${cargos}"/>
    <meta name="twitter:image" th:content="${ruta_controller_imagen} + ${persona.id}"/>
    <meta name="twitter:site_name" content="personas.ucam" />

    <meta property='og:title' th:content="${persona.nombre_mostrar} + ' | UCAM Universidad Católica de Murcia'"/>
    <meta property="og:description" th:if="${cargos != null}" th:content="${persona.nombre_mostrar} + ${cargos}"/>
    <meta property="og:image" th:content="${ruta_controller_imagen} + ${persona.id}"/>
    <meta property="og:site_name" content="personas.ucam"/>

    <meta property='og:type' content='website'/>
    <meta property="fb:app_id" content="501593976526558" />
    End of Metadata-->

    <link rel="stylesheet" th:href="@{/assets/plugins/ucam-icons/styles.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/swiper.min.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/main.styles.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/swiper.min.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/styles.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/departamento.component.css}"/>

</head>
<body>

<header>
    <nav class="navbar navbar-light bg-info justify-content-end">
        <a class="navbar-brand mr-auto" th:href="@{/personas}">
            <img class="img-fluid" th:src="@{/assets/img/logo.svg?0102}" width="200" height="50" alt="Logo UCAM Personas">
        </a>

        <!-- login
          <div class="dropdown">
            <a class="decoration-none" href="#" id="loginButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="icon-button icon-perm-identity text-color-ucam-gray-medium"></span>
            </a>
            <div class="dropdown-menu dropdown-menu-right text-center p-3" aria-labelledby="loginButton">
              <span class="icon-button icon-button-xl text-size-subtitulo1 icon-perm-identity text-color-ucam-gray-medium"></span>
              <p class="dropdown-header">Iniciar sesión</p>
              <form id="loginForm" action="#">
                <button type="submit" class="btn btn-info">Iniciar sesión</button>
              </form>
            </div>
          </div>

          <div class="dropdown">
            <a class="decoration-none rounded-circle" href="#" id="loginButton2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <img src="data:image/png;base64," alt="Miguel Ángel Abenza" class="img-fluid" width="36">
            </a>
            <div class="dropdown-menu dropdown-menu-right text-center p-3" aria-labelledby="loginButton">

              <a href="#" title="Editar foto" class="edit-photo-link">
                <div class="photo-mask">
                  <img src="data:image/png;base64," alt="Miguel Ángel Abenza" width="70">
                </div>
                <span class="edit-photo">
                  <img th:src="@{assets/img/icon-camera.svg}" alt="Icono editar foto">
                </span>
              </a>

              <p class="dropdown-header"></p>
              <p>
                <small></small>
              </p>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="http://key.ucam.edu">
                <i class="icon-key"></i> Cambiar contraseña</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="https://inf.ucam.edu/personasucam/">
                <i class="icon-ajustes"></i> Modificar privacidad</a>
              <div class="dropdown-divider"></div>

              <button type="button" class="btn btn-info mt-3">Cerrar sesión</button>

            </div>
          </div>-->

    </nav>
</header>

<article class="profile">
    <!-- portada -->
    <section>
        <div class="hero bg-ucam-gray-lighter">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-12 col-md-6 col-lg-5 order-md-2 d-flex align-items-end"></div>

                    <div class="col-12 col-md-6 col-lg-5 order-md-1 profile__contact-data d-flex flex-column">
                        <a class="back-link mt-3 d-none d-md-block" onclick="history.back()" title="Volver atrás">< Volver atrás</a>

                        <div class="data-wrapper flex-1 flex-column justify-content-center d-none d-md-flex ng-star-inserted">
                            <h2 class="text-size-titulo1 font-weight-bold mt-5 mt-md-0" th:text="${nombreDepartamento}"></h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container d-block d-md-none">
            <div class="row">
                <div class="col-12 profile__contact-data ng-star-inserted">
                    <h2 class="text-size-titulo1 font-weight-bold mt-4 mt-md-0" th:text="${nombreDepartamento}"></h2>
                </div>
            </div>
        </div>
    </section>
    <!-- end portada -->

    <!-- contenido -->
    <section class="profile__content">
        <div class="container mt-0 ng-star-inserted">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-10">
                    <div class="tab-content" id="results-content">
                        <hr>
                        <h3 class="text-size-subtitulo1" style="margin-bottom: 25px; color: #3c5162">Personas departamento</h3>

                        <div class="row">
                            <!--Todo scroll infinito-->
                            <!--Item-->
                            <div class="col-12 col-md-6 ng-star-inserted" th:each="persona: ${personasEncontradas}">
                                <div class="card mb-3">
                                    <div class="row no-gutters">
                                        <div class="col-auto p-3">
                                            <img class="img-fluid ng-star-inserted" height="105" width="86" th:src="'data:image/png;base64,' + ${persona.foto}">
                                        </div>
                                        <div class="col">
                                            <div class="card-body d-flex flex-column justify-content-end h-100">
                                                <p class="card-title flex-1">
                                                    <a th:title="${persona.nombre_mostrar}" th:text="${persona.nombre_mostrar}"></a>
                                                </p>
                                                <p class="card-text ng-star-inserted" th:if="${persona.correos_institucionales != null && !persona.correos_institucionales.isEmpty()}">
                                                    <i class="icon-email"></i>
                                                    <a th:href="'mailto:' + ${persona.correos_institucionales[0]}" th:title="'Enviar correo a ' + ${persona.correos_institucionales[0]}" th:text="${persona.correos_institucionales[0]}"></a>
                                                </p>
                                                <p class="card-text ng-star-inserted" th:if="${persona.extension != null}">
                                                    <i class="icon-phone"></i>
                                                    <a th:href="'tel:' + ${persona.extension}" th:title="'Llamar a la extensión' + ${persona.extension}" th:text="${persona.extension}"></a>
                                                </p>
                                                <p class="card-text ng-star-inserted" th:if="${persona.ubicacion != null}">
                                                    <i class="icon-room"></i>
                                                    <span th:text="${persona.ubicacion}"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--end of item-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- end contenido -->

</article>

<script th:src="@{/assets/js/vendor/jquery.slim.min.js}"></script>
<script th:src="@{/assets/js/vendor/bootstrap.min.js}"></script>
<script th:src="@{/assets/js/vendor/popper.min.js}"></script>
<script th:src="@{/assets/js/main.scripts.js}"></script>
<script th:src="@{/assets/js/vendor/swiper.js}"></script>
<script th:src="@{/assets/js/profile.scripts.js}"></script>
<!--Script para el boton de volver arriba-->
<script>
    window.onscroll = function () {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("btn-up").style.display = "block";
        } else {
            document.getElementById("btn-up").style.display = "none";
        }

        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("btn-up").style.display = "block";
        } else {
            document.getElementById("btn-up").style.display = "none";
        }
    };

    document.getElementById("btn-up").onclick = function () {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    };
</script>


<!--Script para scroll infinito-->
<script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    $(document).ready(function() {
        $(window).on('scroll', function() {
            if ($(document).height() - $(this).height() <= $(this).scrollTop()) {

                    if($('.cont_personas').last().val() != null){
                        contPersonas = $('.cont_personas').last().val();
                    }

                    $.ajax({
                        type: 'GET',
                        url: $url,
                        data: { variable: contPersonas },
                        dataType: 'html'
                    })
                        .done(function (data) {
                            $('#resultados-personal').append(data);
                            console.log('Personas encontrados correctamente');
                        })
                        .fail(function () {
                            console.log('Error al buscar personas');
                        });


                if($('#facultades-tab').hasClass('active')){
                    if($('.cont_departamentos').last().val() != null){
                        contDepartamentos = $('.cont_departamentos').last().val();
                    }

                    $.ajax({
                        type: 'GET',
                        url: $url2,
                        data: { variable: contDepartamentos },
                        dataType: 'html'
                    })
                        .done(function(data) {
                            $('#resultados-departamentos').append(data);
                            console.log('Departamentos encontrados correctamente');
                        })
                        .fail(function() {
                            console.log('Error al buscar departamentos');
                        });
                }
                if($('#publicaciones-tab').hasClass('active')){
                    if($('.cont_publicaciones').last().val() != null){
                        contPublicaciones = $('.cont_publicaciones').last().val();
                        console.log(contPublicaciones);
                    }

                    $.ajax({
                        type: 'GET',
                        url: $url3,
                        data: { variable: contPublicaciones },
                        dataType: 'html'
                    })
                        .done(function(data) {
                            $('#resultados-publicaciones').append(data);
                            console.log('Publicaciones encontradas correctamente');
                        })
                        .fail(function() {
                            console.log('Error al buscar publicaciones');
                        });
                }
            }
        });
    });
</script>

</body>
</html>
